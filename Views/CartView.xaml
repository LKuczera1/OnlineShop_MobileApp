<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="OnlineShop_MobileApp.Views.CartView">

    <Grid RowDefinitions="6*,1*"
          Padding="12">

        <!-- Komunikat gdy użytkownik nie jest zalogowany -->
        <Label Grid.Row="0"
               Text="Log in to use this feature"
               HorizontalOptions="Center"
               VerticalOptions="Center">
            <Label.Triggers>
                <DataTrigger TargetType="Label"
                             Binding="{Binding IsCartViewAvailable}"
                             Value="True">
                    <Setter Property="IsVisible"
                            Value="False" />
                </DataTrigger>
            </Label.Triggers>
        </Label>

        <!-- LISTA (pokazuj tylko gdy user zalogowany) -->
        <CollectionView Grid.Row="0"
                        ItemsSource="{Binding Items}"
                        IsVisible="{Binding IsCartViewAvailable}"
                        VerticalScrollBarVisibility="Never">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border Margin="0,0,0,2"
                            Padding="8,8,8,12"
                            BackgroundColor="Black"
                            StrokeThickness="0"
                            MinimumHeightRequest="100">

                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="8" />
                        </Border.StrokeShape>

                        <!-- 3 kolumny: Thumbnail | Tekst | Kontrolki -->
                        <Grid ColumnDefinitions="Auto,*,Auto"
                              ColumnSpacing="12"
                              VerticalOptions="Center">

                            <!-- LEWA: Thumbnail -->
                            <Border Grid.Column="0"
                                    WidthRequest="80"
                                    HeightRequest="80"
                                    Padding="0"
                                    StrokeThickness="0"
                                    BackgroundColor="Transparent"
                                    VerticalOptions="Center">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="6" />
                                </Border.StrokeShape>

                                <Border.Clip>
                                    <RoundRectangleGeometry CornerRadius="6"
                                                            Rect="0,0,80,80" />
                                </Border.Clip>

                                <Image Source="{Binding product.ThumbnailSource}"
                                       Aspect="AspectFill"
                                       Background="White" />
                            </Border>

                            <!-- ŚRODEK: Name na górze, Description pod spodem -->
                            <VerticalStackLayout Grid.Column="1"
                                                 Spacing="2"
                                                 VerticalOptions="Center">

                                <Label Text="{Binding product.Name}"
                                       FontSize="15"
                                       TextColor="White"
                                       LineBreakMode="TailTruncation" />

                                <Label Text="{Binding product.Description}"
                                       FontSize="10"
                                       TextColor="White"
                                       Opacity="0.8"
                                       LineBreakMode="WordWrap" />
                            </VerticalStackLayout>

                            <!-- PRAWA: przyciski -->
                            <VerticalStackLayout Grid.Column="2"
                                                 Spacing="4"
                                                 VerticalOptions="Center"
                                                 HorizontalOptions="End">

                                <HorizontalStackLayout Spacing="8"
                                                       VerticalOptions="Center"
                                                       HorizontalOptions="End">

                                    <Button Text="-"
                                            WidthRequest="44"
                                            HeightRequest="44"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentView}},
                                  Path=BindingContext.DecreaseCommand}"
                                            CommandParameter="{Binding .}" />

                                    <Frame WidthRequest="44"
                                           HeightRequest="44"
                                           Padding="0"
                                           BorderColor="#777"
                                           BackgroundColor="Transparent">
                                        <Label Text="{Binding Quantity}"
                                               TextColor="White"
                                               HorizontalOptions="Center"
                                               VerticalOptions="Center" />
                                    </Frame>

                                    <Button Text="+"
                                            WidthRequest="44"
                                            HeightRequest="44"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentView}},
                                  Path=BindingContext.IncreaseCommand}"
                                            CommandParameter="{Binding .}" />

                                    <Button Text="U"
                                            WidthRequest="44"
                                            HeightRequest="44"
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type ContentView}},
                                  Path=BindingContext.RemoveCommand}"
                                            CommandParameter="{Binding .}" />
                                </HorizontalStackLayout>

                                <Label FontSize="12"
                                       TextColor="White"
                                       Opacity="0.8"
                                       HorizontalTextAlignment="End">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Price per unit: " />
                                            <!-- dto.Price, 2 cyfry po przecinku -->
                                            <Span Text="{Binding dto.Price, StringFormat='{0:0.00}'}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                                <Label FontSize="12"
                                       TextColor="White"
                                       Opacity="0.8"
                                       HorizontalTextAlignment="End">
                                    <Label.FormattedText>
                                        <FormattedString>
                                            <Span Text="Total price: " />
                                            <!-- dto.Price, 2 cyfry po przecinku -->
                                            <Span Text="{Binding TotalPrice, StringFormat='{0:0.00}'}" />
                                        </FormattedString>
                                    </Label.FormattedText>
                                </Label>

                            </VerticalStackLayout>

                        </Grid>
                    </Border>
                </DataTemplate>


            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- DÓŁ: placeholder (ukryj gdy user niezalogowany) -->
        <Border Grid.Row="1"
                Padding="12"
                Margin="0,5,0,0"
                IsVisible="{Binding IsCartViewAvailable}"
                BackgroundColor="Black"
                MaximumHeightRequest="200"
                StrokeThickness="0">

            <Grid ColumnDefinitions="7*,3*">
                <Grid RowDefinitions="*,*,*"
                      Grid.Column="0">

                    <Label Text="Order summary:"
                           Grid.Row="0"/>

                    <Label TextColor="White"
                           Grid.Row="1">
                        <Label.FormattedText>
                            <FormattedString>
                                <Span Text="Total price: " />
                                <Span Text="{Binding TotalPrice, StringFormat='{0:0.00}'}" />
                            </FormattedString>
                        </Label.FormattedText>
                    </Label>

                    <Label Text="Pay to send order request"
                           Grid.Row="2" />
                </Grid>

                <Button Grid.Column="1"
                        Text="Pay order"
                        Command="{Binding PlaceOrderCommand}"/>

            </Grid>
        </Border>

    </Grid>
</ContentView>
